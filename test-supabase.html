<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Supabase Connection</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    h1 { color: #00d4ff; }
    .input-group {
      margin: 20px 0;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input {
      width: 100%;
      padding: 10px;
      border: 1px solid #333;
      background: #2a2a2a;
      color: #fff;
      border-radius: 5px;
      font-size: 14px;
    }
    button {
      background: #00d4ff;
      color: #000;
      border: none;
      padding: 12px 24px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      margin: 10px 10px 10px 0;
    }
    button:hover {
      background: #00b8e6;
    }
    #result {
      margin-top: 20px;
      padding: 20px;
      border-radius: 5px;
      background: #2a2a2a;
      border-left: 4px solid #00d4ff;
    }
    .success { color: #4ade80; }
    .error { color: #f87171; }
    .info { color: #60a5fa; }
    pre {
      background: #1a1a1a;
      padding: 10px;
      border-radius: 5px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>üß™ Supabase Connection Tester</h1>
  <p>Use this tool to test your Supabase connection and verify your setup.</p>

  <div class="input-group">
    <label for="url">Supabase URL</label>
    <input type="text" id="url" placeholder="https://your-project.supabase.co">
  </div>

  <div class="input-group">
    <label for="key">Supabase Anon Key</label>
    <input type="text" id="key" placeholder="your-anon-key">
  </div>

  <button onclick="testConnection()">Test Connection</button>
  <button onclick="testTables()">Test Tables</button>
  <button onclick="testInsert()">Test Insert</button>

  <div id="result"></div>

  <script>
    let supabase;

    function initSupabase() {
      const url = document.getElementById('url').value;
      const key = document.getElementById('key').value;
      
      if (!url || !key) {
        showResult('error', 'Please enter both URL and Anon Key');
        return false;
      }

      supabase = window.supabase.createClient(url, key);
      return true;
    }

    async function testConnection() {
      if (!initSupabase()) return;

      showResult('info', 'Testing connection...');

      try {
        const { data, error } = await supabase.from('comments').select('count');
        
        if (error) throw error;
        
        showResult('success', `‚úÖ Connection successful! Database is accessible.`);
      } catch (error) {
        showResult('error', `‚ùå Connection failed: ${error.message}`);
      }
    }

    async function testTables() {
      if (!initSupabase()) return;

      showResult('info', 'Testing tables...');

      const tables = ['comments', 'project_views', 'project_likes'];
      let results = '';

      for (const table of tables) {
        try {
          const { data, error } = await supabase.from(table).select('count');
          
          if (error) throw error;
          
          results += `‚úÖ Table "${table}" exists and is accessible\n`;
        } catch (error) {
          results += `‚ùå Table "${table}" error: ${error.message}\n`;
        }
      }

      showResult('info', results);
    }

    async function testInsert() {
      if (!initSupabase()) return;

      showResult('info', 'Testing insert...');

      try {
        const { data, error } = await supabase
          .from('comments')
          .insert({
            project_slug: 'test-project',
            name: 'Test User',
            message: 'This is a test comment',
            approved: true
          })
          .select();

        if (error) throw error;

        showResult('success', `‚úÖ Insert successful!\n\nInserted comment:\n${JSON.stringify(data, null, 2)}`);
      } catch (error) {
        showResult('error', `‚ùå Insert failed: ${error.message}\n\nMake sure RLS policies allow inserts!`);
      }
    }

    function showResult(type, message) {
      const resultDiv = document.getElementById('result');
      resultDiv.className = type;
      resultDiv.innerHTML = `<pre>${message}</pre>`;
    }

    // Check for env variables in URL
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('url')) {
      document.getElementById('url').value = urlParams.get('url');
    }
    if (urlParams.get('key')) {
      document.getElementById('key').value = urlParams.get('key');
    }
  </script>
</body>
</html>
